From 33a5a7ea5959357ef375e21a91da7a4eb8db6449 Mon Sep 17 00:00:00 2001
From: Alexander Barabash <alexander_barabash@mentor.com>
Date: Tue, 8 Dec 2015 14:06:40 +0200
Subject: [PATCH 01/11] Add optional LTTng support in configure.

---
 configure.ac | 21 +++++++++++++++++++++
 1 file changed, 21 insertions(+)

diff --git a/configure.ac b/configure.ac
index 53c1afe..d01fb33 100644
--- a/configure.ac
+++ b/configure.ac
@@ -572,6 +572,26 @@ if test "x${GST_DISABLE_GST_DEBUG}" != "xyes"; then
   AC_TYPE_SIZE_T
 fi
 
+dnl lttng tracepoints
+AC_ARG_ENABLE(lttng-tracepoints,
+   AC_HELP_STRING([--enable-lttng-tracepoints],
+                  [generate lttng tracepoints @<:@default=no@:>@]),
+   [AS_CASE(
+       [$enableval], [no], [], [yes], [], [auto], [],
+       [AC_MSG_ERROR([bad value "$enableval" for --enable-lttng-tracepoints])])],
+   [enable_lttng_tracepoints=no])
+AS_IF([test "x$enable_lttng_tracepoints" != "xno"],
+      [PKG_CHECK_MODULES([LTTNG_UST], [lttng-ust >= 2.0],
+                         [AC_DEFINE(GST_ENABLE_LTTNG_TRACEPOINTS, [1],
+                                    [Enable LTTng tracepoints.])
+                          LIBS="$LIBS $LTTNG_UST_LIBS -ldl"
+                          CFLAGS="$LIBS $LTTNG_UST_CFLAGS"
+                          enable_lttng_tracepoints=yes],
+                         [AS_IF([test "x$enable_lttng_tracepoints" = "xyes"],
+                                [AC_MSG_ERROR([lttng-ust not found])],
+                                [enable_lttng_tracepoints=no])])])
+AM_CONDITIONAL(GST_ENABLE_LTTNG_TRACEPOINTS, [test "x$enable_lttng_tracepoints" = "xyes"])
+
 dnl *** checks for dependency libraries ***
 
 dnl GLib
@@ -900,6 +920,7 @@ Configuration
 	Unit testing support       : ${BUILD_CHECK}
 
 	Debug                      : ${USE_DEBUG}
+	LTTng tracepoints          : ${enable_lttng_tracepoints}
 	Profiling                  : ${USE_PROFILING}
 
 	Building benchmarks        : ${BUILD_BENCHMARKS}
-- 
1.9.1

