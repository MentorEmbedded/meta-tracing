From 89ce45ba69b48a1389639b3de79e4de52237ef6c Mon Sep 17 00:00:00 2001
From: Sajjad Ahmed <sajjad_ahmed@mentor.com>
Date: Thu, 12 Sep 2019 14:05:58 +0500
Subject: [PATCH 01/11] Add optional LTTng support in configure

---
 configure.ac | 21 +++++++++++++++++++++
 1 file changed, 21 insertions(+)

diff --git a/configure.ac b/configure.ac
index 2b59482..00982ff 100644
--- a/configure.ac
+++ b/configure.ac
@@ -782,6 +782,26 @@ if test "x${GST_DISABLE_GST_DEBUG}" != "xyes"; then
   AC_TYPE_SIZE_T
 fi
 
+dnl lttng tracepoints
+AC_ARG_ENABLE(lttng-tracepoints,
+   AC_HELP_STRING([--enable-lttng-tracepoints],
+                  [generate lttng tracepoints @<:@default=no@:>@]),
+   [AS_CASE(
+       [$enableval], [no], [], [yes], [], [auto], [],
+       [AC_MSG_ERROR([bad value "$enableval" for --enable-lttng-tracepoints])])],
+   [enable_lttng_tracepoints=no])
+AS_IF([test "x$enable_lttng_tracepoints" != "xno"],
+      [PKG_CHECK_MODULES([LTTNG_UST], [lttng-ust >= 2.0],
+                         [AC_DEFINE(GST_ENABLE_LTTNG_TRACEPOINTS, [1],
+                                    [Enable LTTng tracepoints.])
+                          LIBS="$LIBS $LTTNG_UST_LIBS -ldl"
+                          CFLAGS="$LIBS $LTTNG_UST_CFLAGS"
+                          enable_lttng_tracepoints=yes],
+                         [AS_IF([test "x$enable_lttng_tracepoints" = "xyes"],
+                                [AC_MSG_ERROR([lttng-ust not found])],
+                                [enable_lttng_tracepoints=no])])])
+AM_CONDITIONAL(GST_ENABLE_LTTNG_TRACEPOINTS, [test "x$enable_lttng_tracepoints" = "xyes"])
+
 dnl *** checks for dependency libraries ***
 
 dnl GLib
@@ -1160,6 +1180,7 @@ Configuration
 	libdw support              : ${HAVE_DW}
 
 	Debug                      : ${USE_DEBUG}
+	LTTng tracepoints          : ${enable_lttng_tracepoints}
 	Profiling                  : ${USE_PROFILING}
 
 	Building benchmarks        : ${BUILD_BENCHMARKS}
-- 
2.7.4

